<%- include ('partials/header.ejs') %>
<style>
    #attributeDropdownContainer,
    #attValDrpdwnContainer,
    #variantTable {
        display: none;
    }
</style>
<!-- Begin page -->
<div id="layout-wrapper">
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="main-content">
        <div class="page-content">
            <div class="container-fluid">
                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div
                            class="page-title-box d-sm-flex align-items-center justify-content-between"
                        >
                            <h4 class="mb-sm-0">Add Product</h4>

                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item">
                                        <a href="javascript: void(0);">
                                            Product</a
                                        >
                                    </li>
                                    <li class="breadcrumb-item active">
                                        Add Product
                                    </li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end page title -->

                <form id="addProductForm" autocomplete="off">
                    <div class="row">
                        <div class="col-lg-12">
                            <div
                                class="d-flex align-items-center flex-wrap gap-2 mb-4"
                            >
                                <ul
                                    class="nav nav-pills arrow-navtabs nav-secondary gap-2 flex-grow-1 order-2 order-lg-1"
                                    role="tablist"
                                >
                                    <!-- Product Information Tab1  -->
                                    <li class="nav-item" role="presentation">
                                        <a
                                            class="nav-link active"
                                            data-bs-toggle="tab"
                                            href="#productinfo"
                                            role="tab"
                                            aria-selected="false"
                                            tabindex="-1"
                                        >
                                            Product Information
                                        </a>
                                    </li>

                                    <!-- Images & Videos Tab2  -->
                                    <li class="nav-item" role="presentation">
                                        <a
                                            class="nav-link"
                                            data-bs-toggle="tab"
                                            href="#proimages"
                                            role="tab"
                                            aria-selected="false"
                                            tabindex="-1"
                                        >
                                            Images & Videos
                                        </a>
                                    </li>

                                    <!-- Product Price & Stock3  -->
                                    <li class="nav-item" role="presentation">
                                        <a
                                            class="nav-link"
                                            data-bs-toggle="tab"
                                            href="#productstock"
                                            role="tab"
                                            aria-selected="false"
                                            tabindex="-1"
                                        >
                                            Product Price & Stock
                                        </a>
                                    </li>

                                    <!-- Description & Specification Tab  -->
                                    <li class="nav-item" role="presentation">
                                        <a
                                            class="nav-link"
                                            data-bs-toggle="tab"
                                            href="#prdescriptions"
                                            role="tab"
                                            aria-selected="true"
                                        >
                                            Description & Specification
                                        </a>
                                    </li>

                                    <li class="nav-item" role="presentation">
                                        <a
                                            class="nav-link"
                                            data-bs-toggle="tab"
                                            href="#others"
                                            role="tab"
                                            aria-selected="false"
                                            tabindex="-1"
                                        >
                                            Others
                                        </a>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <a
                                            class="nav-link"
                                            data-bs-toggle="tab"
                                            href="#seo"
                                            role="tab"
                                            aria-selected="false"
                                            tabindex="-1"
                                        >
                                            SEO
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card">
                                <div class="tab-content">
                                    <!-- Product Information Tab -->
                                    <div
                                        class="tab-pane active"
                                        id="productinfo"
                                        role="tabpanel"
                                    >
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-xxl-12">
                                                    <div class="row">
                                                        <div
                                                            class="col-lg-6 mb-3"
                                                        >
                                                            <label
                                                                for="productCategories"
                                                                class="form-label"
                                                                >Select
                                                                Vendor</label
                                                            >
                                                            <select
                                                                class="form-control"
                                                                id="vendor-field"
                                                                name="vendor_id"
                                                            >
                                                                <option
                                                                    value=""
                                                                    selected
                                                                >
                                                                    Select
                                                                    Vendor
                                                                </option>
                                                                <% vendor.forEach(function(element) { 
                                                                    let displayName = (element.first_name || element.last_name) ? (element.first_name + " " + element.last_name).trim() : null; %>
                                                                    <option value="<%= element._id %>">
                                                                        <%= displayName ? displayName : "" %>
                                                                    </option>
                                                                <% }); %>
                                                            </select>
                                                        </div>
                                                        <div
                                                            class="col-lg-6 mb-3"
                                                        >
                                                            <label
                                                                for="productCategories"
                                                                class="form-label"
                                                                >Select
                                                                Categories
                                                                <span
                                                                    class="text-danger"
                                                                    >*</span
                                                                ></label
                                                            >
                                                            <select
                                                                class="form-control"
                                                                id="category-field"
                                                                name="category_id"
                                                            >
                                                                <option
                                                                    value=""
                                                                    selected
                                                                >
                                                                    Select
                                                                    Category
                                                                </option>
                                                                <%
                                                                categoriesForDropdown.forEach(function(category)
                                                                { %>
                                                                <option
                                                                    value="<%= category._id %>"
                                                                >
                                                                    <%=
                                                                    category.prefix
                                                                    %><%=
                                                                    category.name
                                                                    %>
                                                                </option>
                                                                <% if
                                                                (category.children
                                                                &&
                                                                category.children.length
                                                                > 0) { %> <%
                                                                category.children.forEach(function(child)
                                                                { %>
                                                                <option
                                                                    value="<%= child._id %>"
                                                                >
                                                                    <%=
                                                                    child.name
                                                                    %>
                                                                </option>
                                                                <% }); %> <% }
                                                                %> <% }); %>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div
                                                            class="col-lg-6 mb-3"
                                                        >
                                                            <label
                                                                for="productTitle"
                                                                class="form-label"
                                                                >Product Name
                                                                <span
                                                                    class="text-danger"
                                                                    >*</span
                                                                ></label
                                                            >
                                                            <input
                                                                type="text"
                                                                class="form-control"
                                                                id="product_name"
                                                                name="product_name"
                                                                placeholder="Enter product name"
                                                            />
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label
                                                                    for="productBrand"
                                                                    class="form-label"
                                                                    >Brand</label
                                                                >
                                                                <select
                                                                    class="form-control"
                                                                    data-choices
                                                                    name="brand_id"
                                                                    id="brand_id"
                                                                >
                                                                    <option
                                                                        value=""
                                                                        disabled
                                                                        selected
                                                                    >
                                                                        Select
                                                                        Brand
                                                                    </option>
                                                                    <%brand.forEach(function(element){
                                                                    %>
                                                                    <option
                                                                        value="<%= element._id %>"
                                                                    >
                                                                        <%=
                                                                        element.name%>
                                                                    </option>
                                                                    <% }); %>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label
                                                                    for="productUnit"
                                                                    class="form-label"
                                                                    >Unit</label
                                                                >
                                                                <select
                                                                    class="form-control"
                                                                    id="unit_id"
                                                                    name="unit_id"
                                                                >
                                                                    <option
                                                                        value=""
                                                                        disabled
                                                                        selected
                                                                    >
                                                                        Select
                                                                        Unit
                                                                    </option>
                                                                    <%
                                                                    unit.forEach(function(element)
                                                                    { %>
                                                                    <option
                                                                        value="<%= element._id %>"
                                                                    >
                                                                        <%=
                                                                        element._id
                                                                        ===
                                                                        element.unit_id
                                                                        ?
                                                                        'selected'
                                                                        : ''
                                                                        %><%=
                                                                        element.name
                                                                        %>
                                                                    </option>
                                                                    <% }); %>
                                                                </select>
                                                            </div>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <label
                                                                for="productStyle"
                                                                class="form-label"
                                                                >Min. Order
                                                                Quantity
                                                                <span
                                                                    class="text-danger"
                                                                    >*</span
                                                                >
                                                            </label>
                                                            <input
                                                                type="number"
                                                                pattern="[0-9]+([\.,][0-9]+)?"
                                                                class="form-control"
                                                                id="min_order_quantity"
                                                                name="min_order_quantity"
                                                                min="1"
                                                                value="1"
                                                                placeholder="Enter min order quantity"
                                                            />
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label
                                                                    for="productUnit"
                                                                    class="form-label"
                                                                    >Tags
                                                                </label>
                                                                <input
                                                                    type="text"
                                                                    class="form-control"
                                                                    id="tags"
                                                                    name="tags"
                                                                    placeholder="Write tags"
                                                                />
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <label
                                                                for="productStyle"
                                                                class="form-label"
                                                                >Slug
                                                                <span
                                                                    class="text-danger"
                                                                    >*</span
                                                                >
                                                            </label>
                                                            <input
                                                                type="text"
                                                                class="form-control"
                                                                id="slug"
                                                                name="slug"
                                                                placeholder="Enter slug"
                                                            />
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div
                                                            class="col-lg-6 mt-2"
                                                        >
                                                            <div
                                                                class="form-group row"
                                                            >
                                                                <label
                                                                    class="col-lg-2 col-from-label form-label"
                                                                    >Status</label
                                                                >
                                                                <div
                                                                    class="col-lg-7 form-check form-switch"
                                                                >
                                                                    <input
                                                                        type="checkbox"
                                                                        name="status_id"
                                                                        id="status_id"
                                                                        class="form-check-input form-check-input-lg"
                                                                        checked
                                                                    />
                                                                    <span
                                                                        class="custom-switch-indicator"
                                                                    ></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Product Images Tab -->
                                    <div
                                        class="tab-pane"
                                        id="proimages"
                                        role="tabpanel"
                                    >
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="card">
                                                        <div
                                                            class="page-title-box d-sm-flex align-items-center justify-content-between"
                                                        >
                                                            <h4 class="mb-sm-0">
                                                                Product Images
                                                            </h4>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label
                                                                class="form-label"
                                                                >Thumbnail
                                                                <span
                                                                    class="text-danger"
                                                                    >*</span
                                                                ></label
                                                            >
                                                            <input
                                                                type="file"
                                                                class="form-control"
                                                                id="thumbnail"
                                                                name="thumbnail"
                                                                placeholder="Upload thumbnail"
                                                            />

                                                            <div
                                                                class="mb-2 mt-2"
                                                                id="previewthumbnailicon"
                                                                style="
                                                                    display: none;
                                                                "
                                                            >
                                                                <img
                                                                    src=""
                                                                    id="display_preview_thumbnail_icon"
                                                                />
                                                            </div>
                                                        </div>

                                                        <div class="mb-3">
                                                            <label
                                                                class="form-label"
                                                                >Gallery Images
                                                                <span
                                                                    class="text-danger"
                                                                    >*</span
                                                                ></label
                                                            >
                                                            <input
                                                                type="file"
                                                                class="form-control"
                                                                id="gallery_image"
                                                                name="gallery_image"
                                                                multiple
                                                                placeholder="Upload gallery image"
                                                            />
                                                            <div
                                                                class="mb-2 mt-2"
                                                                id="previewgalleryicon"
                                                                style="
                                                                    display: none;
                                                                "
                                                            >
                                                                <img
                                                                    src=""
                                                                    id="display_preview_gallery_icon"
                                                                />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card">
                                                        <div
                                                            class="card-header extra-padding"
                                                        >
                                                            <h4>
                                                                Product Video
                                                            </h4>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <div
                                                                    class="col-lg-9"
                                                                >
                                                                    <label
                                                                        for="productStyle"
                                                                        class="form-label"
                                                                        >Video
                                                                        URL
                                                                    </label>
                                                                    <input
                                                                        type="text"
                                                                        class="form-control"
                                                                        id="video_url"
                                                                        name="video_url"
                                                                        placeholder="Enter video url"
                                                                    />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--end col-->
                                            </div>
                                            <!--end row-->
                                        </div>
                                    </div>

                                    <!-- Product Price & Stock Tab -->
                                    <div
                                        class="tab-pane"
                                        id="productstock"
                                        role="tabpanel"
                                    >
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="card">
                                                        <div class="row gy-3">
                                                            <div
                                                                class="col-lg-9"
                                                            >
                                                                <div>
                                                                    <label
                                                                        class="form-label"
                                                                        for="product-price-input"
                                                                        >Unit
                                                                        Price
                                                                        <span
                                                                            class="text-danger"
                                                                            >*</span
                                                                        ></label
                                                                    >
                                                                    <div
                                                                        class="input-group has-validation"
                                                                    >
                                                                        <span
                                                                            class="input-group-text"
                                                                            id="product-price-addon"
                                                                            >₹</span
                                                                        >
                                                                        <input
                                                                            type="number"
                                                                            pattern="[0-9]+([\.,][0-9]+)?"
                                                                            class="form-control"
                                                                            id="unit_price"
                                                                            name="unit_price"
                                                                            step="any"
                                                                            min="0"
                                                                            placeholder="Enter unit price"
                                                                            aria-label="Price"
                                                                            aria-describedby="product-price-addon"
                                                                        />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!--end col-->
                                                            <div
                                                                class="col-lg-6"
                                                            >
                                                                <div>
                                                                    <label
                                                                        class="form-label"
                                                                        for="manufacturer-brand-input"
                                                                        >Special
                                                                        Discount
                                                                        Type</label
                                                                    >
                                                                    <select
                                                                        class="form-control"
                                                                        id="special_discount_type"
                                                                        name="special_discount_type"
                                                                    >
                                                                        <option
                                                                            value=""
                                                                            disabled
                                                                            selected
                                                                        >
                                                                            Select
                                                                            Discount
                                                                            Type
                                                                        </option>
                                                                        <option
                                                                            value="flat"
                                                                        >
                                                                            Flat
                                                                        </option>
                                                                        <option
                                                                            value="percentage"
                                                                        >
                                                                            Percentage
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div
                                                                class="col-lg-6"
                                                            >
                                                                <div>
                                                                    <label
                                                                        class="form-label"
                                                                        for="product-discount-input"
                                                                        >Special
                                                                        Discount</label
                                                                    >
                                                                    <div
                                                                        class="input-group"
                                                                    >
                                                                        <span
                                                                            class="input-group-text"
                                                                            id="product-discount-addon"
                                                                            >%</span
                                                                        >
                                                                        <input
                                                                            type="number"
                                                                            class="form-control"
                                                                            pattern="[0-9]+([\.,][0-9]+)?"
                                                                            id="special_discount"
                                                                            name="special_discount"
                                                                            placeholder="Enter discount"
                                                                            aria-label="discount"
                                                                            aria-describedby="product-discount-addon"
                                                                        />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div
                                                                class="col-lg-12"
                                                            >
                                                                <div
                                                                    class="form-group"
                                                                >
                                                                    <label
                                                                        for="special_discount_period"
                                                                        class="form-label"
                                                                        >Special
                                                                        Discount
                                                                        Period</label
                                                                    >
                                                                    <input
                                                                        type="text"
                                                                        name="special_discount_period"
                                                                        id="special_discount_period"
                                                                        class="form-control daterange-cus"
                                                                        placeholder="Select Date Range"
                                                                    />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="card">
                                                        <div
                                                            class="page-title-box d-sm-flex align-items-center justify-content-between"
                                                        >
                                                            <h4 class="mb-sm-0">
                                                                Product Stock
                                                            </h4>
                                                            <div
                                                                class="col-lg-6"
                                                            >
                                                                <div
                                                                    class="form-check form-switch"
                                                                >
                                                                    <input
                                                                        class="form-check-input"
                                                                        type="checkbox"
                                                                        role="switch"
                                                                        id="variant"
                                                                        name="variant"
                                                                        onchange="toggleVariant()"
                                                                    />
                                                                    <label
                                                                        class="form-check-label"
                                                                        for="variant"
                                                                        >Has
                                                                        Variant</label
                                                                    >
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row gy-3">
                                                            <div
                                                                class="col-lg-6"
                                                            >
                                                                <div>
                                                                    <label
                                                                        for="manufacturer-name-input"
                                                                        class="form-label"
                                                                        >Minimum
                                                                        Stock
                                                                        Warning
                                                                    </label>
                                                                    <input
                                                                        type="number"
                                                                        pattern="[0-9]+([\.,][0-9]+)?"
                                                                        class="form-control"
                                                                        id="min_stock_quantity"
                                                                        name="min_stock_quantity"
                                                                        min="0"
                                                                        placeholder="Enter minimum stock"
                                                                    />
                                                                </div>
                                                            </div>
                                                            <!--end col-->
                                                            <div
                                                                class="col-lg-6"
                                                            >
                                                                <div>
                                                                    <label
                                                                        class="form-label"
                                                                        for="manufacturer-brand-input"
                                                                        >Stock
                                                                        Visibility</label
                                                                    >
                                                                    <select
                                                                        class="form-control"
                                                                        id="stock_visibility"
                                                                        name="stock_visibility"
                                                                    >
                                                                        <option
                                                                            value=""
                                                                            disabled
                                                                            selected
                                                                        >
                                                                            Select
                                                                            Stock
                                                                            Visibility
                                                                        </option>
                                                                        <option
                                                                            value="hide_stock"
                                                                        >
                                                                            Hide
                                                                            Stock
                                                                        </option>
                                                                        <option
                                                                            value="visible_with_quantity"
                                                                        >
                                                                            Visible
                                                                            with
                                                                            quantity
                                                                        </option>
                                                                        <option
                                                                            value="visible_with_text"
                                                                        >
                                                                            Visible
                                                                            with
                                                                            text
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <!--end col-->
                                                            <div
                                                                class="col-lg-6"
                                                                id="skuContainer"
                                                            >
                                                                <div>
                                                                    <label
                                                                        for="sku"
                                                                        class="form-label"
                                                                        >SKU
                                                                        <span
                                                                            class="text-danger"
                                                                            >*</span
                                                                        ></label
                                                                    >
                                                                    <input
                                                                        type="text"
                                                                        class="form-control"
                                                                        id="sku"
                                                                        name="sku"
                                                                        placeholder="Enter SKU"
                                                                    />
                                                                </div>
                                                            </div>
                                                            <div
                                                                class="col-lg-6"
                                                                id="stockContainer"
                                                            >
                                                                <div>
                                                                    <label
                                                                        for="current_stock"
                                                                        class="form-label"
                                                                        >Current Stock
                                                                        <span
                                                                            class="text-danger"
                                                                            >*</span
                                                                        ></label
                                                                    >
                                                                    <input
                                                                        type="text"
                                                                        class="form-control"
                                                                        id="current_stock"
                                                                        name="current_stock"
                                                                        min="0"
                                                                        placeholder="Enter current stock"
                                                                    />
                                                                </div>
                                                            </div>
                                                            <div
                                                                id="attributeDropdownContainer"
                                                            >
                                                                <div
                                                                    class="form-group"
                                                                >
                                                                    <label
                                                                        class="form-label"
                                                                        >Colors</label
                                                                    >
                                                                    <div
                                                                        class="row gutters-xs"
                                                                    ></div>
                                                                </div>
                                                                <div
                                                                    class="form-group row"
                                                                >
                                                                    <div
                                                                        class="col-md-3"
                                                                    >
                                                                        <input
                                                                            type="text"
                                                                            class="form-control"
                                                                            value="Attribute Sets"
                                                                            disabled=""
                                                                        />
                                                                    </div>
                                                                    <div
                                                                        class="col-md-9"
                                                                    >
                                                                        <select
                                                                            class="form-control select2 attribute-sets select2-hidden-accessible"
                                                                            id="attribute_sets_id"
                                                                            name="attribute_sets_id"
                                                                            multiple=""
                                                                            tabindex="-1"
                                                                            aria-hidden="true"
                                                                        >
                                                                            <%attributes.forEach(function(element){
                                                                            %>
                                                                            <option
                                                                                value="<%= element._id %>"
                                                                            >
                                                                                <%=
                                                                                element.title%>
                                                                            </option>
                                                                            <%
                                                                            });
                                                                            %>
                                                                        </select>
                                                                        <p
                                                                            class="invalid-feedback text-info"
                                                                        >
                                                                            N.B:
                                                                            Select
                                                                            Attribute
                                                                            sets
                                                                            of
                                                                            this
                                                                            product
                                                                            to
                                                                            add
                                                                            attribute
                                                                            values
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div
                                                                class="attribute-values"
                                                                id="attValDrpdwnContainer"
                                                            >
                                                                <div
                                                                    class="form-group row"
                                                                >
                                                                    <div
                                                                        class="col-md-3"
                                                                    >
                                                                        <input
                                                                            type="text"
                                                                            class="form-control"
                                                                            id="attribute_value_input"
                                                                        />
                                                                    </div>
                                                                    <div
                                                                        class="col-md-9"
                                                                    >
                                                                        <select
                                                                            class="form-control select2 variant select2-hidden-accessible"
                                                                            name="attribute_value_id"
                                                                            id="attribute_value_id"
                                                                            multiple=""
                                                                            tabindex="-1"
                                                                            aria-hidden="true"
                                                                            onchange="showTable()"
                                                                        >
                                                                            <%attributeValues.forEach(function(element){
                                                                            %>
                                                                            <option
                                                                                value="<%= element._id %>"
                                                                            >
                                                                                <%=
                                                                                element.value%>
                                                                            </option>
                                                                            <%
                                                                            });
                                                                            %>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <!-- Product Stock Table  -->
                                                        <div
                                                            class="form-group row variant-table mt-3"
                                                            id="variantTable"
                                                        >
                                                            <table
                                                                class="table table-striped table-bordered product-variant-table"
                                                            >
                                                                <thead>
                                                                    <tr>
                                                                        <td
                                                                            scope="col"
                                                                        >
                                                                            Variant
                                                                        </td>
                                                                        <td
                                                                            scope="col"
                                                                        >
                                                                            Price
                                                                            *
                                                                        </td>
                                                                        <td
                                                                            scope="col"
                                                                        >
                                                                            SKU
                                                                            *
                                                                        </td>
                                                                        <td
                                                                            scope="col"
                                                                        >
                                                                            Current
                                                                            Stock
                                                                            *
                                                                        </td>
                                                                        <td
                                                                            scope="col"
                                                                        >
                                                                            Image
                                                                        </td>
                                                                        <td>
                                                                            Action
                                                                        </td>
                                                                    </tr>
                                                                </thead>
                                                                <tbody
                                                                    id="variantTableBody"
                                                                >
                                                                    <!-- Rows will be added by JavaScript -->
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <!-- Product Stock Table  -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Product Description Tab -->
                                    <div
                                        class="tab-pane"
                                        id="prdescriptions"
                                        role="tabpanel"
                                    >
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-lg-12 mb-3">
                                                    <div>
                                                        <label
                                                            class="form-label"
                                                            >Short Description
                                                        </label>
                                                        <textarea
                                                            class="form-control"
                                                            type="text"
                                                            name="short_description"
                                                            id="short_description"
                                                            rows="3"
                                                            placeholder="Enter short description"
                                                        ></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12 mb-3">
                                                    <div>
                                                        <label
                                                            class="form-label"
                                                            >Long Description
                                                        </label>
                                                        <textarea
                                                            type="text"
                                                            class="form-control"
                                                            id="editor"
                                                            name="long_description"
                                                            placeholder="Enter Long Description"
                                                        ></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12 mb-3">
                                                    <div>
                                                        <label
                                                            class="form-label"
                                                            >Description Image
                                                        </label>
                                                        <input
                                                            type="file"
                                                            class="form-control"
                                                            id="description_image"
                                                            name="description_image"
                                                            multiple
                                                            placeholder="Upload description image"
                                                        />

                                                        <div
                                                            class="mb-2 mt-2"
                                                            id="previewdescriptionicon"
                                                            style="
                                                                display: none;
                                                            "
                                                        >
                                                            <img
                                                                src=""
                                                                id="display_preview_description_icon"
                                                            />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div
                                                class="page-title-box d-sm-flex align-items-center justify-content-between"
                                            >
                                                <h4 class="mb-sm-0">
                                                    PDF Specification
                                                </h4>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12 mb-3">
                                                    <div>
                                                        <label
                                                            class="form-label"
                                                            >PDF Specification
                                                        </label>
                                                        <input
                                                            type="file"
                                                            class="form-control"
                                                            id="pdf"
                                                            name="pdf"
                                                            placeholder="Upload pdf"
                                                        />
                                                        <div
                                                            class="mb-2 mt-2"
                                                            id="previewpdficon"
                                                            style="
                                                                display: none;
                                                            "
                                                        >
                                                            <embed
                                                                src=""
                                                                id="display_preview_pdf_icon"
                                                            />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Others Tab -->
                                    <div
                                        class="tab-pane"
                                        id="others"
                                        role="tabpanel"
                                    >
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="card">
                                                        <div
                                                            class="page-title-box d-sm-flex align-items-center justify-content-between"
                                                        >
                                                            <h4 class="mb-sm-0">
                                                                Statuses
                                                            </h4>
                                                        </div>
                                                        <div
                                                            class="card-body extra-padding"
                                                        >
                                                            <div
                                                                class="form-group row mt-2"
                                                            >
                                                                <label
                                                                    class="col-lg-5 col-from-label"
                                                                    >Featured</label
                                                                >
                                                                <div
                                                                    class="col-lg-7 form-check form-switch"
                                                                >
                                                                    <input
                                                                        type="checkbox"
                                                                        name="is_featured"
                                                                        id="is_featured"
                                                                        class="form-check-input"
                                                                    />
                                                                    <span
                                                                        class="custom-switch-indicator"
                                                                    ></span>
                                                                    <label
                                                                        class="form-check-label"
                                                                        for="variant"
                                                                        >Add to
                                                                        Featured</label
                                                                    >
                                                                </div>
                                                            </div>

                                                            <div
                                                                class="form-group row mt-2"
                                                            >
                                                                <label
                                                                    class="col-lg-5 col-from-label"
                                                                    >Today's
                                                                    Deal</label
                                                                >
                                                                <div
                                                                    class="col-lg-7 form-check form-switch"
                                                                >
                                                                    <input
                                                                        type="checkbox"
                                                                        name="todays_deal"
                                                                        id="todays_deal"
                                                                        class="form-check-input"
                                                                    />
                                                                    <span
                                                                        class="custom-switch-indicator"
                                                                    ></span>
                                                                    <label
                                                                        class="form-check-label"
                                                                        for="variant"
                                                                        >Add to
                                                                        Today's
                                                                        Deal</label
                                                                    >
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--end col-->
                                            </div>
                                            <!--end row-->
                                        </div>
                                    </div>

                                    <!-- SEO Tab -->
                                    <div
                                        class="tab-pane"
                                        id="seo"
                                        role="tabpanel"
                                    >
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="card">
                                                        <div class="row gy-3">
                                                            <div
                                                                class="col-lg-9"
                                                            >
                                                                <div>
                                                                    <label
                                                                        for="product-manufacturer"
                                                                        class="form-label"
                                                                        >Meta
                                                                        Title</label
                                                                    >
                                                                    <input
                                                                        type="text"
                                                                        class="form-control"
                                                                        id="meta_title"
                                                                        name="meta_title"
                                                                        placeholder="Enter Meta Title"
                                                                    />
                                                                </div>
                                                            </div>
                                                            <!--end col-->
                                                            <div
                                                                class="col-lg-12"
                                                            >
                                                                <div>
                                                                    <label
                                                                        class="form-label"
                                                                        for="productPacker"
                                                                        >Meta
                                                                        Description</label
                                                                    >
                                                                    <textarea
                                                                        type="text"
                                                                        class="form-control"
                                                                        id="meta_description"
                                                                        name="meta_description"
                                                                        placeholder="Enter Meta Description"
                                                                    ></textarea>
                                                                </div>
                                                            </div>
                                                            <!--end col-->
                                                            <div
                                                                class="col-lg-9"
                                                            >
                                                                <div>
                                                                    <label
                                                                        for="productimporter"
                                                                        class="form-label"
                                                                        >Meta
                                                                        Keywords</label
                                                                    >
                                                                    <input
                                                                        type="text"
                                                                        class="form-control"
                                                                        id="meta_keywords"
                                                                        name="meta_keywords"
                                                                        placeholder="Enter Meta Keywords"
                                                                    />
                                                                </div>
                                                            </div>

                                                            <div
                                                                class="col-lg-9"
                                                            >
                                                                <div>
                                                                    <label
                                                                        for="productGname"
                                                                        class="form-label"
                                                                        >Meta
                                                                        Image</label
                                                                    >
                                                                    <input
                                                                        type="file"
                                                                        class="form-control"
                                                                        id="meta_image"
                                                                        name="meta_image"
                                                                        multiple
                                                                        placeholder="Upload Meta Image"
                                                                    />

                                                                    <div
                                                                        class="mb-2 mt-2"
                                                                        id="previewmetaicon"
                                                                        style="
                                                                            display: none;
                                                                        "
                                                                    >
                                                                        <img
                                                                            src=""
                                                                            id="display_preview_meta_icon"
                                                                        />
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--end col-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="hstack gap-2 justify-content-end mb-3">
                        <button type="submit" class="btn btn-thm">
                            Submit
                        </button>
                    </div>
                </form>
            </div>
            <!-- container-fluid -->
        </div>
        <!-- End Page-content -->
    </div>
    <!-- end main content-->
</div>
<!-- END layout-wrapper -->

<%- include ('partials/footer.ejs') %>
<script src="/admin/js/ckeditor/ckeditor.js"></script>
<script src="/admin/js/ck.js"></script>

<!-- toggleVariant javascript -->
<script>
    function toggleVariant() {
        const variantCheckbox = document.getElementById("variant");
        const skuContainer = document.getElementById("skuContainer");
        const attributeDropdownContainer = document.getElementById("attributeDropdownContainer");
        const attValDrpdwnContainer = document.getElementById("attValDrpdwnContainer");
        const variantTable = document.getElementById("variantTable");
        const stockContainer = document.getElementById("stockContainer");

        if (variantCheckbox.checked) {
            skuContainer.style.display = "none";
            attributeDropdownContainer.style.display = "block";
            stockContainer.style.display = "none"; // Hide stock container when variant is on
        } else {
            skuContainer.style.display = "block";
            attributeDropdownContainer.style.display = "none";
            attValDrpdwnContainer.style.display = "none";
            variantTable.style.display = "none";
            stockContainer.style.display = "block"; // Show stock container when variant is off
        }
    }
</script>

<!-- Date Range Picker For Discount period-->
<script>
    $(function () {
        $('input[name="special_discount_period"]').daterangepicker({
            timePicker: true,
            autoUpdateInput: false,
            locale: {
                format: "DD/MM/YYYY hh:mm A",
                cancelLabel: "Clear",
            },
        });
        $('input[name="special_discount_period"]').on(
            "apply.daterangepicker",
            function (ev, picker) {
                $(this).val(
                    picker.startDate.format("DD/MM/YYYY hh:mm A") +
                        " - " +
                        picker.endDate.format("DD/MM/YYYY hh:mm A")
                );
            }
        );

        $('input[name="special_discount_period"]').on(
            "cancel.daterangepicker",
            function (ev, picker) {
                $(this).val("");
            }
        );
    });
    document
        .getElementById("special_discount_type")
        .addEventListener("change", function () {
            const discountType = this.value;
            const discountAddon = document.getElementById(
                "product-discount-addon"
            );

            if (discountType === "flat") {
                discountAddon.textContent = "₹"; // Use ₹ for flat discount
            } else if (discountType === "percentage") {
                discountAddon.textContent = "%"; // Use % for percentage discount
            } else {
                discountAddon.textContent = ""; // Clear if no type is selected
            }
        });
</script>

<!--function script showAttributeValues showTable -->
<script>
    $(document).on("change", ".attribute-sets", function (e) {
        var form = $("#addProductForm");
        var formData = form.serializeArray();
        var jsonData = {};

        $.each(formData, function () {
            if (jsonData[this.name]) {
                // If the name already exists, push the new value to the array
                if (Array.isArray(jsonData[this.name])) {
                    jsonData[this.name].push(this.value);
                } else {
                    jsonData[this.name] = [jsonData[this.name], this.value];
                }
            } else {
                // If the name does not exist, create it
                jsonData[this.name] = this.value;
            }
        });
        if (jsonData["attribute_sets_id"]) {
            jsonData.attributeSetIds = jsonData["attribute_sets_id"];
            delete jsonData["attribute_sets_id"];
        }

        const attValDrpdwnContainer = document.getElementById(
            "attValDrpdwnContainer"
        );
        attValDrpdwnContainer.innerHTML = "";
        const attValTable = document.getElementById("variantTable");
        attValTable.innerHTML = "";
        $.ajax({
            url: "/admin/product/get-attribute-values",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(jsonData),
            success: function (attributeValues) {
                attValDrpdwnContainer.innerHTML = attributeValues;
                $(".select2").select2();
            },
            error: function (data) {},
        });
        $("#attValDrpdwnContainer").show();
    });

    $(document).on("change", ".variant", function (e) {
        var form = $("#addProductForm");
        var formData = form.serializeArray();
        var jsonData = {};

        $.each(formData, function () {
            if (jsonData[this.name]) {
                // If the name already exists, push the new value to the array
                if (Array.isArray(jsonData[this.name])) {
                    jsonData[this.name].push(this.value);
                } else {
                    jsonData[this.name] = [jsonData[this.name], this.value];
                }
            } else {
                // If the name does not exist, create it
                jsonData[this.name] = this.value;
            }
        });
        if (jsonData["attribute_sets_id[]"]) {
            jsonData.attributeSetIds = Array.isArray(
                jsonData["attribute_sets_id"]
            )
                ? jsonData["attribute_sets_id"]
                : [jsonData["attribute_sets_id"]];

            delete jsonData["attribute_sets_id"];
        }
        const attValTable = document.getElementById("variantTable");
        attValTable.innerHTML = "";
        $.ajax({
            url: "/admin/product/get-variant",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(jsonData),
            success: function (attributeValues) {
                attValTable.innerHTML = attributeValues;
            },
            error: function (data) {},
        });
        $("#variantTable").show();
    });

    let selectedAttributeValues = {};
    function showAttributeValues() {
        const attributeDropdown = document.getElementById("attribute_sets_id");
        const attValDrpdwnContainer = document.getElementById(
            "attValDrpdwnContainer"
        );
        attValDrpdwnContainer.innerHTML = "";
        var attributeSets = JSON.parse('<%- JSON.stringify(attributes) %>');
        var selectedAttributeSets = $("#attribute_sets_id").val();

        if (selectedAttributeSets.length > 0) {
            selectedAttributeSets.forEach(function (attributeSetId) {
                var selectedAttributeSet = attributeSets.find(function (
                    element
                ) {
                    return element._id === attributeSetId;
                });
                if (!selectedAttributeValues[attributeSetId]) {
                    selectedAttributeValues[attributeSetId] = [];
                }
                var form = $("#addProductForm");
                var formData = form.serializeArray();
                var jsonData = {};

                $.each(formData, function () {
                    jsonData[this.name] = this.value;
                });

                $.ajax({
                    url: "/admin/product/get-attribute-values",
                    type: "POST",
                    data: JSON.stringify(jsonData),
                    contentType: "application/json",
                    success: function (attributeValues) {
                        var attributeValueSelect =
                            document.createElement("select");
                        attributeValueSelect.className =
                            "form-control select2 variant";
                        attributeValueSelect.name = "attribute_value_id";
                        attributeValueSelect.multiple = true;
                        attributeValueSelect.setAttribute(
                            "data-set-name",
                            selectedAttributeSet.title
                        );
                        attributeValueSelect.onchange = function () {
                            selectedAttributeValues[attributeSetId] =
                                $(this).val();
                            showTable();
                        };

                        attributeValues.forEach(function (element) {
                            var option = document.createElement("option");
                            option.value = element._id;
                            option.textContent = element.value;
                            if (
                                selectedAttributeValues[
                                    attributeSetId
                                ].includes(element._id)
                            ) {
                                option.selected = true;
                            }
                            attributeValueSelect.appendChild(option);
                        });

                        var attributeValueContainer =
                            document.createElement("div");
                        attributeValueContainer.className = "form-group row";

                        var labelCol = document.createElement("div");
                        labelCol.className = "col-md-3 mb-3";

                        var label = document.createElement("input");
                        label.type = "text";
                        label.className = "form-control";
                        label.value = selectedAttributeSet.title;
                        label.disabled = true;

                        labelCol.appendChild(label);

                        var selectCol = document.createElement("div");
                        selectCol.className = "col-md-9";
                        selectCol.appendChild(attributeValueSelect);

                        attributeValueContainer.appendChild(labelCol);
                        attributeValueContainer.appendChild(selectCol);

                        attValDrpdwnContainer.appendChild(
                            attributeValueContainer
                        );

                        $(".select2").select2();
                    },
                    error: function (error) {
                        console.error(
                            "Error fetching attribute value: ",
                            error.message
                        );
                    },
                });
            });
            $("#attValDrpdwnContainer").show();
        } else {
            $("#attValDrpdwnContainer").hide();
            $("#variantTable").hide();
        }
    }

    function showTable() {
        var attributeValues = JSON.parse(
           '<%- JSON.stringify(attributeValues) %>'
        );
        var selectedAttributeValues = [];

        $("#attValDrpdwnContainer select").each(function () {
            var values = $(this).val();
            if (values) {
                selectedAttributeValues =
                    selectedAttributeValues.concat(values);
            }
        });
        selectedAttributeValues.forEach(function (attributeValueId) {
            var attributeValue = attributeValues.find(function (element) {
                return element._id === attributeValueId;
            });

            // Check if a row already exists for this attribute value
            var existingRow = $("#variantTableBody").find(
                `tr[data-value-id="${attributeValueId}"]`
            );

            if (existingRow.length > 0) {
                existingRow.find('input[name="price"]').val();
                existingRow.find('input[name="sku"]').val();
                existingRow.find('input[name="current_stock"]').val();
            } else {
                var row = `
                <tr data-value-id="${attributeValueId}">
                    <td width="18%">
                        <label class="font-normal">${attributeValue.value}</label>
                    </td>
                    <td width="18%">
                        <input type="number" lang="en" name="price" id="price" value="0" min="0" step="any" class="form-control" pattern="[0-9]+([\.,][0-9]+)?" />
                    </td>
                    <td width="18%">
                        <input type="text" name="sku" id="sku" class="form-control" />
                    </td>
                    <td width="18%">
                        <input type="number" lang="en" name="current_stock" id="current_stock" value="" min="0" step="1" class="form-control" pattern="[0-9]+([\.,][0-9]+)?" />
                    </td>
                    <td width="22%">
                        <div>
                            <input type="file" name="image" id="image" multiple class="form-control" />
                        </div>
                    </td>
                    <td width="6%">
                        <button type="button" class="btn btn-icon btn-sm btn-danger remove-menu-row" onclick="$(this).closest('tr').remove();">
                            <i class="bx bx-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
                $("#variantTableBody").append(row);
            }
        });
        // Ensure the variant table is visible
        $("#variantTable").show();
    }
</script>


<!-- Script for addProductForm Ajax -->
<script>
    var addform = $("#addProductForm");
    addform.on("submit", submitFormHandler);

    function submitFormHandler(e) {
        e.preventDefault();

        if ($("#product_name").val() == "") {
            iziToast.warning({
                title: "Warning",
                message: "Product Name is required",
                position: "topRight",
            });
            return;
        }
        if ($("#min_order_quantity").val() == "") {
            iziToast.warning({
                title: "Warning",
                message: "Min Order Quantity is required",
                position: "topRight",
            });
            return;
        }
        if ($("#slug").val() == "") {
            iziToast.warning({
                title: "Warning",
                message: "Slug is required",
                position: "topRight",
            });
            return;
        }
        if (
            $("#category-field").val() == null ||
            $("#category-field").val() == ""
        ) {
            iziToast.warning({
                title: "Warning",
                message: "Category is required",
                position: "topRight",
            });
            return;
        }
        if ($("#thumbnail").val() == "") {
            iziToast.warning({
                title: "Warning",
                message: "Thumbnail is required",
                position: "topRight",
            });
            return;
        }
        if ($("#gallery_image").val() == "") {
            iziToast.warning({
                title: "Warning",
                message: "Gallery Image is required",
                position: "topRight",
            });
            return;
        }
        if ($("#unit_price").val() == "") {
            iziToast.warning({
                title: "Warning",
                message: "Unit Price is required",
                position: "topRight",
            });
            return;
        }
        if ($("#status_id").val() == "") {
            iziToast.warning({
                title: "Warning",
                message: "Status is required",
                position: "topRight",
            });
            return;
        }

        const variantChecked = document.getElementById("variant").checked;
        var formData;

        if (variantChecked) {
            var attributeValueIds = [];
            var skus = [];
            var currentStocks = [];
            var prices = [];
            var images = [];

            $("#variantTableBody tr").each(function () {
                var attributeValueId = $(this)
                    .find('select[name="attribute_value_id"]')
                    .val();
                var sku = $(this).find('input[name="sku"]').val();
                var currentStock = $(this)
                    .find('input[name="current_stock"]')
                    .val();
                var price = $(this).find('input[name="price"]').val();
                var image = $(this).find('input[name="image"]').val();

                attributeValueIds.push(attributeValueId);
                skus.push(sku);
                currentStocks.push(currentStock);
                prices.push(price);
                images.push(image);
            });

            formData = getFormData($("#addProductForm"));
            formData.attribute_value_id = attributeValueIds.filter(
                (val) => val
            );
            formData.sku = skus.filter((val) => val);
            formData.current_stock = currentStocks.filter((val) => val);
            formData.price = prices.filter((val) => val);
            formData.image = images.filter((val) => val);
        } else {
            var sku = $("#sku").val();
            var current_stock = $("#current_stock").val();

            if (!sku) {
                iziToast.error({
                    title: "Error",
                    message: "SKU is required for non-variant product",
                    position: "topRight",
                });
                return;
            }
            if (!current_stock) {
                iziToast.error({
                    title: "Error",
                    message: "Current Stock is required for non-variant product",
                    position: "topRight",
                });
                return;
            }

            formData = getFormData($("#addProductForm"));
            formData.sku = sku;
        }

        var currentForm = addform[0];
        var hasImages =
            currentForm.querySelector('input[type="file"]').files.length > 0;
        if (hasImages) {
            formData = new FormData(currentForm);
        } else {
            formData = getFormData(addform);
        }

        $.ajax({
            type: "POST",
            url: "/admin/product/add",
            data: hasImages ? formData : JSON.stringify(formData),
            cache: false,
            contentType: hasImages ? false : "application/json",
            processData: !hasImages,
        })
            .done((res) => {
                if (res.status == 200) {
                    iziToast.success({
                        title: "Success",
                        message: res.message,
                        position: "topRight",
                    });
                } else {
                    iziToast.error({
                        title: "Error",
                        message: res.message,
                        position: "topRight",
                    });
                }
                setTimeout(function () {
                    window.location.href = "/admin/product/list";
                }, 1000);
            })
            .fail(function (xhr, status, error) {
                iziToast.error({
                    title: "Error",
                    message: xhr.responseText,
                    position: "topRight",
                });
            });
    }

    $("#thumbnail").change(function () {
        displayPP(this, $("#previewthumbnailicon"));
    });
    $("#gallery_image").change(function () {
        displayPP(this, $("#previewgalleryicon"));
    });
    $("#description_image").change(function () {
        displayPP(this, $("#previewdescriptionicon"));
    });
    $("#pdf").change(function () {
        displayPDF(this, $("#previewpdficon"));
    });
    $("#meta_image").change(function () {
        displayPP(this, $("#previewmetaicon"));
    });
</script>

<!-- Slug generation script -->
<script>
    function generateSlug(name) {
        return name
            .toLowerCase()
            .replace(/[^a-z0-9\s-]/g, "")
            .replace(/\s+/g, "-");
    }

    // Generate slug when product name is entered
    $("#product_name").on("input", function () {
        var slug = generateSlug($(this).val());
        $("#slug").val(slug);
    });
</script>
